<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Information</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f2f2f2; }
        img { max-width: 25%; height: auto; margin-top: 20px; border: 5px solid #ccc; border-radius: 10px; }
        a.button { display: inline-block; padding: 10px 20px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 5px; }
        a.button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <canvas id="greetingCanvas" style="display: none;"></canvas>
    <img id="selectedCardImage" alt="Selected card">
    <br>
    <a id="downloadButton" class="button">تحميل الصورة</a>
    <br>
    <button onclick="window.history.back();" class="button">العودة</button>

    <script>
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        var userName = getParameterByName('name');
        var selectedChoice = getParameterByName('choice');

        var imageURL;
        var fontSize;
        var textXPercentage;
        var textYPercentage;

        var words = userName.split(' '); // تقسيم النص إلى كلمات
var numWords = words.length; // عدد الكلمات في النص

// تعيين الحجم والموقع بناءً على عدد الكلمات
switch (selectedChoice) {
    case '1':
        imageURL = 'images/card.jpeg';
        if (numWords === 1) {
            fontSize = '40px';
            textXPercentage = 45;
            textYPercentage = 65;
        } else if (numWords === 2) {
            fontSize = '30px';
            textXPercentage = 45;
            textYPercentage = 65;
        } else if (numWords === 3) {
            fontSize = '25px';
            textXPercentage = 45;
            textYPercentage = 65;
        } else {
            fontSize = '20px';
            textXPercentage = 45;
            textYPercentage = 65;
        }
        break;
    case '2':
        imageURL = 'images/card-2.jpg';
        if (numWords === 1) {
            fontSize = '400px';
            textXPercentage = 50;
            textYPercentage = 65;
        } else if (numWords === 2) {
            fontSize = '300px';
            textXPercentage = 50;
            textYPercentage = 65;
        } else if (numWords === 3) {
            fontSize = '250px';
            textXPercentage = 50;
            textYPercentage = 65;
        } else {
            fontSize = '200px';
            textXPercentage = 50;
            textYPercentage = 65;
        }
        break;
    case '3':
        imageURL = 'images/card-3.jpg';
        if (numWords === 1) {
            fontSize = '200px';
            textXPercentage = 45;
            textYPercentage = 84;
        } else if (numWords === 2) {
            fontSize = '190px';
            textXPercentage = 35;
            textYPercentage = 84;
        } else if (numWords === 3) {
            fontSize = '160px';
            textXPercentage = 34;
            textYPercentage = 83.7;
        }else if (numWords === 4) {
            fontSize = '140px';
            textXPercentage = 30;
            textYPercentage = 83.7; 
        }else {
            fontSize = '140px';
            textXPercentage = 28;
            textYPercentage = 83.7;
        }
        break;
    default:
        break;
}


        var img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = function () {
            var canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            ctx.fillStyle = 'black';
            ctx.font = fontSize + ' Arial';
            ctx.fillText(userName, (textXPercentage / 100) * canvas.width, (textYPercentage / 100) * canvas.height);
            var selectedCardImage = document.getElementById('selectedCardImage');
            selectedCardImage.src = canvas.toDataURL('image/jpeg');

            var downloadButton = document.getElementById('downloadButton');
            downloadButton.href = canvas.toDataURL('image/jpeg');
            downloadButton.download = 'selected_card.jpg';
        };
        img.src = imageURL;
    </script>
</body>
</html>
